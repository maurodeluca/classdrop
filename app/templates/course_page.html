<!DOCTYPE html>
<html>
<head>
    <title>ClassDrop - Available Resources</title>
    <link rel="stylesheet" type="text/css" href="/static/styles.css">
    <script>
        async function fetchFiles() {
            try {
                const response = await fetch('/files/');
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`${response.status} ${response.statusText} - ${errorData.detail}`);
                }
                const data = await response.json();
                const files = data.files;

                const tableBody = document.getElementById('files-table-body');
                tableBody.innerHTML = ''; // Clear any existing rows

                if (files.length > 0) {
                    files.forEach(file => {
                        const row = document.createElement('tr');

                        // Format the upload timestamp
                        const uploadDate = new Date(file.upload_timestamp);
                        const formattedDate = uploadDate.toLocaleString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit',
                        });

                        row.innerHTML = `
                            <td>${file.filename}</td>
                            <td>${file.size_in_bytes.toFixed(2)}</td>
                            <td>${formattedDate}</td>
                            <td>
                                <form action="/files/${file.file_id}" method="get">
                                    <button type="submit">Download</button>
                                </form>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    const noFilesRow = document.createElement('tr');
                    noFilesRow.innerHTML = `<td colspan="4">No files uploaded yet.</td>`;
                    tableBody.appendChild(noFilesRow);
                }
            } catch (error) {
                console.error('Failed to fetch files:', error);
                const tableBody = document.getElementById('files-table-body');
                tableBody.innerHTML = `<tr><td colspan="4">Failed to load files.</td></tr>`;
            }
        }

        // Fetch files when the page loads
        window.onload = fetchFiles;
    </script>
</head>
<body>
    <h1>Available Resources</h1>

    <table>
        <thead>
            <tr>
                <th>Filename</th>
                <th>Size (Bytes)</th>
                <th>Uploaded At</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="files-table-body">
            <tr>
                <td colspan="4">Loading files...</td>
            </tr>
        </tbody>
    </table>
</body>
</html>
